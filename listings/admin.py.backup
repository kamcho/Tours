from django.contrib import admin
from .models import PlaceCategory, Place, TravelGroup, PlaceImage, GroupTours, Agency, AgencyService
from .models import * 
# Register your models here.

def verify_places(modeladmin, request, queryset):
    queryset.update(verified=True)
verify_places.short_description = "Mark selected places as verified"

def unverify_places(modeladmin, request, queryset):
    queryset.update(verified=False)
unverify_places.short_description = "Mark selected places as unverified"

def verify_agencies(modeladmin, request, queryset):
    queryset.update(verified=True)
verify_agencies.short_description = "Mark selected agencies as verified"

def unverify_agencies(modeladmin, request, queryset):
    queryset.update(verified=False)
unverify_agencies.short_description = "Mark selected agencies as unverified"

admin.site.register(PlaceCategory)
@admin.register(Place)
class PlaceAdmin(admin.ModelAdmin):
    list_display = ['name', 'get_categories', 'location', 'verified', 'is_active', 'created_by', 'created_at']
    list_filter = ['categories', 'verified', 'is_active', 'created_at']
    search_fields = ['name', 'description', 'location', 'address']
    list_editable = ['verified', 'is_active']
    readonly_fields = ['created_at', 'updated_at']


# Business Chat Admin

@admin.register(Business)
class BusinessAdmin(admin.ModelAdmin):
    list_display = ['name', 'industry', 'location', 'email', 'phone', 'created_at']
    list_filter = ['industry', 'created_at']
    search_fields = ['name', 'email', 'location']
    readonly_fields = ['created_at', 'updated_at']
    
    fieldsets = (
        ('Basic Information', {
            'fields': ('name', 'description', 'industry', 'company_size')
        }),
        ('Contact Information', {
            'fields': ('email', 'phone', 'whatsapp_number', 'website', 'location')
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        })
    )


@admin.register(UserBusinessInquiry)
class UserBusinessInquiryAdmin(admin.ModelAdmin):
    list_display = ['user', 'business', 'status', 'created_at']
    list_filter = ['status', 'business', 'created_at']
    search_fields = ['user__email', 'business__name', 'message']
    readonly_fields = ['created_at', 'updated_at']
    
    fieldsets = (
        ('Inquiry Details', {
            'fields': ('business', 'user', 'message', 'status')
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        })
    )


@admin.register(BusinessAIIquiryResponse)
class BusinessAIIquiryResponseAdmin(admin.ModelAdmin):
    list_display = ['inquiry', 'created_at']
    list_filter = ['created_at']
    search_fields = ['inquiry__user__email', 'inquiry__business__name', 'response']
    readonly_fields = ['created_at']
    
    fieldsets = (
        ('Response Details', {
            'fields': ('inquiry', 'response')
        }),
        ('Timestamps', {
            'fields': ('created_at',),
            'classes': ('collapse',)
        })
    )
    actions = [verify_places, unverify_places]
    filter_horizontal = ['categories']
    fieldsets = (
        ('Basic Information', {
            'fields': ('name', 'description', 'categories', 'verified')
        }),
        ('Location', {
            'fields': ('location', 'address')
        }),
        ('Contact Information', {
            'fields': ('website', 'contact_email', 'contact_phone')
        }),
        ('Media', {
            'fields': ('profile_picture', 'place_intro_video')
        }),
        ('Relationships', {
            'fields': ('created_by',)
        }),
        ('Status', {
            'fields': ('is_active',)
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )
    
    def get_categories(self, obj):
        """Display categories as comma-separated list in admin"""
        return ", ".join([cat.name for cat in obj.categories.all()])
    get_categories.short_description = "Categories"

admin.site.register(TravelGroup)
admin.site.register(PlaceImage)
@admin.register(GroupTours)
class GroupToursAdmin(admin.ModelAdmin):
    list_display = ['name', 'creator', 'status', 'start_date', 'end_date', 'price_per_person', 'max_participants', 'current_participants', 'created_at']
    list_filter = ['status', 'start_date', 'end_date', 'created_at']
    search_fields = ['name', 'description', 'creator__email', 'to']
    list_editable = ['status']
    readonly_fields = ['created_at', 'updated_at', 'current_participants']
    fieldsets = (
        ('Basic Information', {
            'fields': ('name', 'description', 'creator', 'status')
        }),
        ('Tour Details', {
            'fields': ('to', 'destination', 'travel_group', 'agency')
        }),
        ('Dates & Capacity', {
            'fields': ('start_date', 'end_date', 'min_participants', 'max_participants', 'current_participants')
        }),
        ('Pricing', {
            'fields': ('price_per_person', 'couple_price')
        }),
        ('Media', {
            'fields': ('display_picture', 'tour_video')
        }),
        ('Tour Information', {
            'fields': ('itinerary', 'included_services', 'excluded_services', 'requirements')
        }),
        ('Demographics', {
            'fields': ('min_age', 'max_age', 'gender')
        }),
        ('Engagement', {
            'fields': ('likes', 'bookmarks')
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )
@admin.register(Agency)
class AgencyAdmin(admin.ModelAdmin):
    list_display = ['name', 'agency_type', 'status', 'verified', 'city', 'country', 'owner', 'created_at']
    list_filter = ['agency_type', 'status', 'verified', 'country', 'created_at']
    search_fields = ['name', 'description', 'city', 'country', 'owner__email']
    list_editable = ['status', 'verified']
    readonly_fields = ['created_at', 'updated_at']


# Business Chat Admin

@admin.register(Business)
class BusinessAdmin(admin.ModelAdmin):
    list_display = ['name', 'industry', 'location', 'email', 'phone', 'created_at']
    list_filter = ['industry', 'created_at']
    search_fields = ['name', 'email', 'location']
    readonly_fields = ['created_at', 'updated_at']
    
    fieldsets = (
        ('Basic Information', {
            'fields': ('name', 'description', 'industry', 'company_size')
        }),
        ('Contact Information', {
            'fields': ('email', 'phone', 'whatsapp_number', 'website', 'location')
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        })
    )


@admin.register(UserBusinessInquiry)
class UserBusinessInquiryAdmin(admin.ModelAdmin):
    list_display = ['user', 'business', 'status', 'created_at']
    list_filter = ['status', 'business', 'created_at']
    search_fields = ['user__email', 'business__name', 'message']
    readonly_fields = ['created_at', 'updated_at']
    
    fieldsets = (
        ('Inquiry Details', {
            'fields': ('business', 'user', 'message', 'status')
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        })
    )


@admin.register(BusinessAIIquiryResponse)
class BusinessAIIquiryResponseAdmin(admin.ModelAdmin):
    list_display = ['inquiry', 'created_at']
    list_filter = ['created_at']
    search_fields = ['inquiry__user__email', 'inquiry__business__name', 'response']
    readonly_fields = ['created_at']
    
    fieldsets = (
        ('Response Details', {
            'fields': ('inquiry', 'response')
        }),
        ('Timestamps', {
            'fields': ('created_at',),
            'classes': ('collapse',)
        })
    )
    actions = [verify_agencies, unverify_agencies]
    fieldsets = (
        ('Basic Information', {
            'fields': ('name', 'description', 'agency_type', 'status', 'verified')
        }),
        ('Contact Information', {
            'fields': ('email', 'phone', 'website')
        }),
        ('Address Information', {
            'fields': ('address', 'city', 'country', 'postal_code')
        }),
        ('Business Information', {
            'fields': ('license_number', 'registration_number', 'year_established', 'legal_documents')
        }),
        ('Social Media', {
            'fields': ('facebook', 'twitter', 'instagram', 'linkedin')
        }),
        ('Media', {
            'fields': ('logo', 'profile_picture')
        }),
        ('Relationships', {
            'fields': ('owner',)
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )
admin.site.register(Event)

@admin.register(TourBookingPayment)
class TourBookingPaymentAdmin(admin.ModelAdmin):
    list_display = ['payment_reference', 'user', 'booking', 'amount', 'payment_method', 'payment_status', 'created_at']
    list_filter = ['payment_method', 'payment_status', 'created_at', 'booking__tour']
    search_fields = ['payment_reference', 'user__email', 'booking__tour__name', 'external_reference']
    list_editable = ['payment_status']
    readonly_fields = ['payment_reference', 'created_at', 'updated_at', 'completed_at']
    date_hierarchy = 'created_at'
    
    fieldsets = (
        ('Payment Information', {
            'fields': ('payment_reference', 'amount', 'payment_method', 'payment_status')
        }),
        ('Booking Details', {
            'fields': ('booking', 'user')
        }),
        ('Transaction Details', {
            'fields': ('external_reference', 'description', 'metadata')
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at', 'completed_at'),
            'classes': ('collapse',)
        }),
    )
    
    def get_queryset(self, request):
        return super().get_queryset(request).select_related('user', 'booking', 'booking__tour')

@admin.register(AgencyService)
class AgencyServiceAdmin(admin.ModelAdmin):
    list_display = ['name', 'agency', 'service_type', 'availability', 'is_featured', 'is_active', 'created_at']
    list_filter = ['service_type', 'availability', 'is_featured', 'is_active', 'created_at', 'agency']
    search_fields = ['name', 'description', 'agency__name']
    list_editable = ['is_featured', 'is_active', 'availability']
    readonly_fields = ['created_at', 'updated_at']


# Business Chat Admin

@admin.register(Business)
class BusinessAdmin(admin.ModelAdmin):
    list_display = ['name', 'industry', 'location', 'email', 'phone', 'created_at']
    list_filter = ['industry', 'created_at']
    search_fields = ['name', 'email', 'location']
    readonly_fields = ['created_at', 'updated_at']
    
    fieldsets = (
        ('Basic Information', {
            'fields': ('name', 'description', 'industry', 'company_size')
        }),
        ('Contact Information', {
            'fields': ('email', 'phone', 'whatsapp_number', 'website', 'location')
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        })
    )


@admin.register(UserBusinessInquiry)
class UserBusinessInquiryAdmin(admin.ModelAdmin):
    list_display = ['user', 'business', 'status', 'created_at']
    list_filter = ['status', 'business', 'created_at']
    search_fields = ['user__email', 'business__name', 'message']
    readonly_fields = ['created_at', 'updated_at']
    
    fieldsets = (
        ('Inquiry Details', {
            'fields': ('business', 'user', 'message', 'status')
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        })
    )


@admin.register(BusinessAIIquiryResponse)
class BusinessAIIquiryResponseAdmin(admin.ModelAdmin):
    list_display = ['inquiry', 'created_at']
    list_filter = ['created_at']
    search_fields = ['inquiry__user__email', 'inquiry__business__name', 'response']
    readonly_fields = ['created_at']
    
    fieldsets = (
        ('Response Details', {
            'fields': ('inquiry', 'response')
        }),
        ('Timestamps', {
            'fields': ('created_at',),
            'classes': ('collapse',)
        })
    )
    
    fieldsets = (
        ('Basic Information', {
            'fields': ('agency', 'service_type', 'name', 'description')
        }),
        ('Service Details', {
            'fields': ('availability', 'is_featured', 'duration')
        }),
        ('Pricing', {
            'fields': ('base_price', 'price_range_min', 'price_range_max', 'pricing_model')
        }),
        ('Group Size', {
            'fields': ('group_size_min', 'group_size_max')
        }),
        ('Media', {
            'fields': ('service_image',)
        }),
        ('Additional Information', {
            'fields': ('requirements', 'included_items', 'excluded_items', 'cancellation_policy'),
            'classes': ('collapse',)
        }),
        ('Status', {
            'fields': ('is_active',)
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )

@admin.register(Features)
class FeaturesAdmin(admin.ModelAdmin):
    list_display = ['name', 'place', 'price', 'duration', 'is_active', 'created_at']
    list_filter = ['is_active', 'created_at', 'place']
    search_fields = ['name', 'description', 'place__name']
    list_editable = ['is_active']
    readonly_fields = ['created_at', 'updated_at']


# Business Chat Admin

@admin.register(Business)
class BusinessAdmin(admin.ModelAdmin):
    list_display = ['name', 'industry', 'location', 'email', 'phone', 'created_at']
    list_filter = ['industry', 'created_at']
    search_fields = ['name', 'email', 'location']
    readonly_fields = ['created_at', 'updated_at']
    
    fieldsets = (
        ('Basic Information', {
            'fields': ('name', 'description', 'industry', 'company_size')
        }),
        ('Contact Information', {
            'fields': ('email', 'phone', 'whatsapp_number', 'website', 'location')
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        })
    )


@admin.register(UserBusinessInquiry)
class UserBusinessInquiryAdmin(admin.ModelAdmin):
    list_display = ['user', 'business', 'status', 'created_at']
    list_filter = ['status', 'business', 'created_at']
    search_fields = ['user__email', 'business__name', 'message']
    readonly_fields = ['created_at', 'updated_at']
    
    fieldsets = (
        ('Inquiry Details', {
            'fields': ('business', 'user', 'message', 'status')
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        })
    )


@admin.register(BusinessAIIquiryResponse)
class BusinessAIIquiryResponseAdmin(admin.ModelAdmin):
    list_display = ['inquiry', 'created_at']
    list_filter = ['created_at']
    search_fields = ['inquiry__user__email', 'inquiry__business__name', 'response']
    readonly_fields = ['created_at']
    
    fieldsets = (
        ('Response Details', {
            'fields': ('inquiry', 'response')
        }),
        ('Timestamps', {
            'fields': ('created_at',),
            'classes': ('collapse',)
        })
    )
    
    fieldsets = (
        ('Basic Information', {
            'fields': ('name', 'description', 'place')
        }),
        ('Pricing & Duration', {
            'fields': ('price', 'duration')
        }),
        ('Media', {
            'fields': ('image',)
        }),
        ('Status', {
            'fields': ('is_active',)
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )

@admin.register(PlaceGallery)
class PlaceGalleryAdmin(admin.ModelAdmin):
    list_display = ['place', 'caption', 'order', 'is_featured', 'created_at']
    list_filter = ['is_featured', 'created_at', 'place']
    search_fields = ['place__name', 'caption', 'alt_text']
    list_editable = ['order', 'is_featured']
    ordering = ['place', 'order', 'created_at']
    
    fieldsets = (
        ('Image Information', {
            'fields': ('place', 'image', 'caption', 'alt_text')
        }),
        ('Display Settings', {
            'fields': ('order', 'is_featured')
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        })
    )
    
    readonly_fields = ['created_at', 'updated_at']


# Business Chat Admin

@admin.register(Business)
class BusinessAdmin(admin.ModelAdmin):
    list_display = ['name', 'industry', 'location', 'email', 'phone', 'created_at']
    list_filter = ['industry', 'created_at']
    search_fields = ['name', 'email', 'location']
    readonly_fields = ['created_at', 'updated_at']
    
    fieldsets = (
        ('Basic Information', {
            'fields': ('name', 'description', 'industry', 'company_size')
        }),
        ('Contact Information', {
            'fields': ('email', 'phone', 'whatsapp_number', 'website', 'location')
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        })
    )


@admin.register(UserBusinessInquiry)
class UserBusinessInquiryAdmin(admin.ModelAdmin):
    list_display = ['user', 'business', 'status', 'created_at']
    list_filter = ['status', 'business', 'created_at']
    search_fields = ['user__email', 'business__name', 'message']
    readonly_fields = ['created_at', 'updated_at']
    
    fieldsets = (
        ('Inquiry Details', {
            'fields': ('business', 'user', 'message', 'status')
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        })
    )


@admin.register(BusinessAIIquiryResponse)
class BusinessAIIquiryResponseAdmin(admin.ModelAdmin):
    list_display = ['inquiry', 'created_at']
    list_filter = ['created_at']
    search_fields = ['inquiry__user__email', 'inquiry__business__name', 'response']
    readonly_fields = ['created_at']
    
    fieldsets = (
        ('Response Details', {
            'fields': ('inquiry', 'response')
        }),
        ('Timestamps', {
            'fields': ('created_at',),
            'classes': ('collapse',)
        })
    )

@admin.register(AgencyGallery)
class AgencyGalleryAdmin(admin.ModelAdmin):
    list_display = ['agency', 'caption', 'order', 'is_featured', 'created_at']
    list_filter = ['is_featured', 'created_at', 'agency']
    search_fields = ['agency__name', 'caption', 'alt_text']
    list_editable = ['order', 'is_featured']
    ordering = ['agency', 'order', 'created_at']
    
    fieldsets = (
        ('Image Information', {
            'fields': ('agency', 'image', 'caption', 'alt_text')
        }),
        ('Display Settings', {
            'fields': ('order', 'is_featured')
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        })
    )
    
    readonly_fields = ['created_at', 'updated_at']


# Business Chat Admin

@admin.register(Business)
class BusinessAdmin(admin.ModelAdmin):
    list_display = ['name', 'industry', 'location', 'email', 'phone', 'created_at']
    list_filter = ['industry', 'created_at']
    search_fields = ['name', 'email', 'location']
    readonly_fields = ['created_at', 'updated_at']
    
    fieldsets = (
        ('Basic Information', {
            'fields': ('name', 'description', 'industry', 'company_size')
        }),
        ('Contact Information', {
            'fields': ('email', 'phone', 'whatsapp_number', 'website', 'location')
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        })
    )


@admin.register(UserBusinessInquiry)
class UserBusinessInquiryAdmin(admin.ModelAdmin):
    list_display = ['user', 'business', 'status', 'created_at']
    list_filter = ['status', 'business', 'created_at']
    search_fields = ['user__email', 'business__name', 'message']
    readonly_fields = ['created_at', 'updated_at']
    
    fieldsets = (
        ('Inquiry Details', {
            'fields': ('business', 'user', 'message', 'status')
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        })
    )


@admin.register(BusinessAIIquiryResponse)
class BusinessAIIquiryResponseAdmin(admin.ModelAdmin):
    list_display = ['inquiry', 'created_at']
    list_filter = ['created_at']
    search_fields = ['inquiry__user__email', 'inquiry__business__name', 'response']
    readonly_fields = ['created_at']
    
    fieldsets = (
        ('Response Details', {
            'fields': ('inquiry', 'response')
        }),
        ('Timestamps', {
            'fields': ('created_at',),
            'classes': ('collapse',)
        })
    )
